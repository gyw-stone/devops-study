# 1. 计算给定命名空间的网络接收字节数
(
  sum by(namespace, pod) (
    irate(container_network_receive_bytes_total{namespace =~ "giveaway|cctip|merchant"}[5m])
  ) / 1024 / 1024
)
/
(clamp_min(
  avg_over_time(
    sum by(namespace, pod) (
      irate(container_network_receive_bytes_total{namespace =~ "giveaway|cctip|merchant"}[5m])
    )[30m:]
  ) / 1024 / 1024,
  0.01
))>1.3


# 2. 判断接口qps是否异常
(
  (
    sum by(path) (rate(nginx_ingress_controller_requests{path!="/cctip/v1"}[30s]))
    >
    avg by(path) (rate(nginx_ingress_controller_requests{path!="/cctip/v1"}[30s] offset 5m)) + 100
  ) 
)
or
(
  avg by(path) (rate(nginx_ingress_controller_requests[1m] offset 5m)) == 0
  and
  sum by(path) (rate(nginx_ingress_controller_requests[1m])) > 50
)
or
(
  sum by (path, namespace) (
    rate(nginx_ingress_controller_requests[5m])
  )
  /
  clamp_min(
    sum by (path, namespace) (
      avg_over_time(rate(nginx_ingress_controller_requests[5m])[30m:])
    ),
    1
  )
) > 1.3
or
((
  sum by(path) (rate(nginx_ingress_controller_requests[5m]))
  /
  clamp_min(sum by(path) (rate(nginx_ingress_controller_requests[5m] offset 5m)), 1)>1.5
)  and
   sum by(path) (rate(nginx_ingress_controller_requests[5m])) > 10)




